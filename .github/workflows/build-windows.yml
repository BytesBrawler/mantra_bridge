name: Build Windows Executable

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install PyInstaller
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
    
    - name: Build executable (runs hidden in background)
      run: |
        pyinstaller --onefile --noconsole --name MantraBridge simple_bridge.pyw
    
    - name: Create setup instructions
      run: |
        echo "# Mantra Bridge - Simple Setup Guide" > dist/README.txt
        echo "" >> dist/README.txt
        echo "## How to Run:" >> dist/README.txt
        echo "1. Double-click MantraBridge.exe" >> dist/README.txt
        echo "2. Nothing will appear on screen (runs hidden in background)" >> dist/README.txt
        echo "3. Open http://127.0.0.1:8765 in browser to verify it's running" >> dist/README.txt
        echo "4. Use svrecharge.in normally with your biometric device" >> dist/README.txt
        echo "" >> dist/README.txt
        echo "## Auto-Start with Windows:" >> dist/README.txt
        echo "1. Press Windows key + R" >> dist/README.txt
        echo "2. Type: shell:startup" >> dist/README.txt
        echo "3. Press Enter" >> dist/README.txt
        echo "4. Copy MantraBridge.exe into that folder" >> dist/README.txt
        echo "5. Done! Now it starts automatically every time you boot Windows" >> dist/README.txt
        echo "" >> dist/README.txt
        echo "## How to Stop:" >> dist/README.txt
        echo "1. Press Ctrl+Alt+Delete" >> dist/README.txt
        echo "2. Click 'Task Manager'" >> dist/README.txt
        echo "3. Find 'MantraBridge.exe' in the list" >> dist/README.txt
        echo "4. Right-click and select 'End Task'" >> dist/README.txt
        echo "" >> dist/README.txt
        echo "## Check if Running:" >> dist/README.txt
        echo "- Open Task Manager (Ctrl+Alt+Delete)" >> dist/README.txt
        echo "- Look for 'MantraBridge.exe' in the processes list" >> dist/README.txt
        echo "- OR visit http://127.0.0.1:8765 in your browser" >> dist/README.txt
        echo "" >> dist/README.txt
        echo "Status Page: http://127.0.0.1:8765" >> dist/README.txt
        echo "Website: https://svrecharge.in" >> dist/README.txt
    
    - name: Upload executable
      uses: actions/upload-artifact@v4
      with:
        name: MantraBridge-Windows
        path: |
          dist/MantraBridge.exe
          dist/README.txt